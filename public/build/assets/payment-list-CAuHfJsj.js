$(function(){var s=$(".datatables-users"),o=$(".select2");if(baseUrl+"",$("#offcanvasAddUser"),o.length&&o.each(function(){$(this).wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:$(this).parent()})}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#searchBtn").click(function(){const e=$("#posting_date_from").val(),t=$("#poting_date_to").val();if(e&&!t){Swal.fire({title:"Error!",text:'Please select the "To Date" when "From Date" is selected.',icon:"error",customClass:{confirmButton:"btn btn-success"}});return}else if(!e&&t){Swal.fire({title:"Error!",text:'Please select the "From Date" when "To Date" is selected.',icon:"error",customClass:{confirmButton:"btn btn-success"}});return}i.ajax.reload()}),s.length)var i=s.DataTable({processing:!0,serverSide:!0,ajax:{url:baseUrl+"payments-list/filter",type:"POST",data:function(e){e.payment_no=$("#payment_no").val(),e.tran_id=$("#invoice_no").val(),e.sending_country_id=$("#sending_country_id").val(),e.receiving_country_id=$("#receiving_country_id").val(),e.file_type=$("#file_type").val(),e.posting_date_from=$("#posting_date_from").val(),e.posting_date_to=$("#poting_date_to").val(),e.status=$("#statuss").val()}},columns:[{data:"#"},{data:"invoice"},{data:"payment_no"},{data:"agent"},{data:"sending_country"},{data:"receiving_country"},{data:"sending_lc"},{data:"sending_fc"},{data:"receiving_amount"},{data:"fx_margin"},{data:"date"},{data:"status"}],columnDefs:[{targets:0,render:function(e,t,n,a){return a.row+1}},{targets:1,render:function(e,t,n,a){return`<span>${n.invoice}</span>`}},{targets:2,render:function(e,t,n,a){return`<span>${n.payment_no}</span>`}},{targets:3,render:function(e,t,n,a){return`<span>${n.agent}</span>`}},{targets:4,render:function(e,t,n,a){return`<span>${n.sending_country}</span>`}},{targets:5,render:function(e,t,n,a){return`<span>${n.receiving_country}</span>`}},{targets:6,render:function(e,t,n,a){return`<span>${n.sending_lc}</span>`}},{targets:7,render:function(e,t,n,a){return`<span>${n.sending_fc}</span>`}},{targets:8,render:function(e,t,n,a){return`<span>${n.receiving_amount}</span>`}},{targets:9,render:function(e,t,n,a){return`<span>${n.fx_margin}</span>`}},{targets:10,render:function(e,t,n,a){return`<span>${n.date}</span>`}},{targets:11,render:function(e,t,n,a){let r;switch(n.status){case"posted":r='<span class="badge bg-success">Posted</span>';break;case"not_posted":r='<span class="badge bg-warning">Not Posted</span>';break;case"failed":r='<span class="badge bg-danger">Failed</span>';break;default:r='<span class="badge bg-secondary">Unknown</span>'}return r}}],order:[[2,"desc"]],dom:'<"row"<"col-md-2"<"ms-n2"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-6 mb-md-0 mt-n6 mt-md-0"f>>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',lengthMenu:[7,10,20,50,70,100],language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search User",info:"Displaying _START_ to _END_ of _TOTAL_ entries",paginate:{next:'<i class="ti ti-chevron-right ti-sm"></i>',previous:'<i class="ti ti-chevron-left ti-sm"></i>'}},responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(e){var t=e.data();return"Details of "+t.name}}),type:"column",renderer:function(e,t,n){var a=$.map(n,function(r,c){return r.title!==""?'<tr data-dt-row="'+r.rowIndex+'" data-dt-column="'+r.columnIndex+'"><td>'+r.title+":</td> <td>"+r.data+"</td></tr>":""}).join("");return a?$('<table class="table"/><tbody />').append(a):!1}}}});document.getElementById("process-button").addEventListener("click",function(){let e=document.getElementById("file_type").value;if(!e){Swal.fire({title:"Warning!",text:"Please select a type before processing.",icon:"warning",customClass:{confirmButton:"btn btn-warning"}});return}fetch("/process-records",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({type:e})}).then(t=>t.json()).then(t=>{t.success?Swal.fire({icon:"success",title:"Processed!",text:"Record processed successfully.",customClass:{confirmButton:"btn btn-success"}}):Swal.fire({title:"Error!",text:t.message||"Something went wrong, record is not processed.",icon:"error",customClass:{confirmButton:"btn btn-danger"}})}).catch(t=>{console.error("Error:",t),Swal.fire({title:"Error!",text:"An unexpected error occurred. Please try again later.",icon:"error",customClass:{confirmButton:"btn btn-danger"}})})})});
